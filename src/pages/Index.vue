<template>
  <Layout class="bg-white">
    <Nav />
    <main>
      <div class="">
        <div
          class="p-5 full overflow-hidden flex justify-center items-center h-screen lg:flex-none"
        >
          <svg
            class=" flex-auto"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 430.58 410.76"
          >
            <g id="TOMATO">
              <path
                id="tomato-path"
                class="cls-1"
                d="M415,241.24c-2.63,51.87-26,101.5-81,135.5-33.11,20.47-77.59,24.38-123,24-48.42-.4-91-10-121-28-48.41-29.05-77.41-80.55-87-131.5-8-42.5-.24-89.93,29-120.5,22-23,62-44,95-34,24.77,7.51,41.56,20,70,20,12.22,0,41.38-22.34,53-24,49-7,89.41,11,119,32C417,148.74,417,201.74,415,241.24Z"
              />
            </g>
            <g id="PLANTaS">
              <path
                class="cls-2"
                d="M352.17,263.42c-1.51-2.6-3.15-5.5-3.36-8.37-.27-3.57-2.08-4.43-4.59-4.85-5.33-.32-11.72,5.33-12.42,10.7-.84,6.54,3.72,10.86,10,8.38.91-.36,2.21-1.29,3.54-1.15s2.7,1.37,3.5,1.3c2.18-.21,2.85-.07,4.43-1.27C355.12,266.74,353.11,265.06,352.17,263.42Zm-12.65-.73a2.58,2.58,0,0,1-1.8-.89v0a2,2,0,0,1,.28-2.61l.33-.31a3.69,3.69,0,0,1,1.84-.74,3.37,3.37,0,0,1,2,.65,2.65,2.65,0,0,1,1.16,1.84c-.19.95-1,1.24-1.56,1.62A4.22,4.22,0,0,1,339.52,262.69Z"
              />
              <path
                class="cls-2"
                d="M90.71,326.39c-2.69-1-5.44-1.77-8-2.93-3.65-1.64-7.14-3.6-10.75-5.31-6.52-3.08-8.06-5.82-6.82-13,1.41-8.24,3.12-16.47,4.32-24.69,2.17-14.76,7.72-28.08,10.88-42.3,1.09-4.89,3.59-9.57,6-14,4-7.28,6.58-6.77,13.39-3.12,4.35,2.33,5.37,6,4,11.33-3,11.48-3.73,20.9-8.93,34.41-1.22,4.35-3.7,8.34-5.16,12.64A55.67,55.67,0,0,0,86.87,291c-.8,7.1,3,12.89,9.74,15.45q4.19,1.59,8.46,2.92c2.13.67,3,1.83,2.63,4.16C106.36,321.62,99.48,326.78,90.71,326.39Z"
              />
              <path
                class="cls-2"
                d="M250.94,280.21a2.58,2.58,0,0,0,1.54-2.22c.08-1.42.15-2.84.2-4.25.08-2.11,0-4.22.09-6.33.55-9.3,1.14-18.6,1.72-27.9.27-4.36,2-6.64,6.18-7.82,3.62-1,7.27-2,11.45-3.09a1.59,1.59,0,0,1,2,1.45c.22,4.35.4,8.21.64,12.07.93,14.42,2,28.82,2.81,43.24.71,12.33,1.18,24.67,1.81,37,.12,2.49.48,5,.65,7.45.31,4.68-1.65,8.1-6.16,9.52-5.43,1.72-10.95,3.18-16.48,4.53-3.18.78-4.82-1.25-5.84-4-3.4-9-6.45-18.14-10.36-26.9-2.84-6.37-3.22-13.13-5.55-19.66-2.14-6-4.53-11.63-6.91-16.91-1-2.15-1.12-4.06-5-4.32a5.51,5.51,0,0,0-3.38,2.55,21.78,21.78,0,0,0-1.68,7.25c-.71,13.21-1,26.45-1.91,39.64a112.2,112.2,0,0,1-3.23,18.7c-.85,3.46-3.39,5.33-7.49,3.88a28.2,28.2,0,0,0-7-1c-2.73-.21-3.62-1.82-3.6-4.26,0-7.82-.23-15.66.21-23.47,1.2-21.34.82-42.81,4.83-63.94,1-5.4,1.78-10.9,3.45-16.1.6-1.85,3.36-3.74,5.46-4.25,6.15-1.51,12.47-2.3,18.71-3.43a4.65,4.65,0,0,1,5.36,2.33c5.91,9.47,9.06,19.92,11.27,30.72,1.17,5.74,2.19,11.51,3.59,17.19a10.67,10.67,0,0,0,.48,1.45,1.64,1.64,0,0,0,2.17.86Z"
              />
              <path
                class="cls-2"
                d="M180.5,333.63c-.45-11.59-.87-23.2-1.73-34.76-.75-9.94-2.16-19.83-3.16-29.76-.44-4.42-1.35-9-.67-13.29a47.64,47.64,0,0,0-.73-20.35c-1.72-6.37-4.12-8.16-10.89-8.51a91.91,91.91,0,0,1-12.64-1.14c-5.42-1-8,.3-9.46,5.75-5.5,20.23-11.12,40.43-16.54,60.68q-4.94,18.45-9.36,37c-1.17,4.86,1.94,9.28,7,10.82a9.15,9.15,0,0,0,11.32-4.87,99.72,99.72,0,0,0,4.52-13q2.88-10.65,5.11-21.47c.91-4.39,3.44-6.49,7.63-7.57,4.82-1.23,6.88-.19,7.28,4.8.3,3.59.22,7.22.3,10.83h-.37c.3,7.61.18,15.26,1,22.81,1.22,11,3.47,12,11,11.1a1.48,1.48,0,0,1,.42,0C177.61,343.39,180.77,340.66,180.5,333.63ZM152.93,275c-3.54,1.62-6.64-1-5.92-4.91a69.91,69.91,0,0,1,3.41-11,3.1,3.1,0,0,1,1.46-1.3,1.4,1.4,0,0,1,1.76.26,3.73,3.73,0,0,1,1.05,1.65,32.07,32.07,0,0,1,.71,9,17.11,17.11,0,0,1-.28,2.58C154.83,272.61,154.23,274.45,152.93,275Z"
              />
              <path
                class="cls-2"
                d="M378.33,284.31c.38-11.32-3-19.95-9.78-27.11-4.42-4.69-9.6-8.67-14-13.4-2.38-2.57-4.7-5.83-5.47-9.14-3-12.94,1.31-27.51,15.42-33.64,12.11-5.27,23.23-2.58,33.86,3.85,4.82,2.93,5.88,10.1,2.71,14.83-2.41,3.6-5.17,3.57-9.76,1.28-4.15-2.06-8.7-4-13.23-4.5-8.55-.94-13.83,3.88-14.41,12.38-.11,1.69,1.11,3.81,2.34,5.17a21,21,0,0,0,6.1,4.84c10.9,5.35,17.49,14.55,23.85,24.47s2.22,19.07-.56,28.26c-2.33,7.71-7.3,14.22-13.14,19.72a21.55,21.55,0,0,1-9.63,5.48c-12.79,2.7-25.35,3.08-35.64-7.26-4.81-4.83-1.82-18.64,4.71-20.42,1.64-.45,3.8.5,5.58,1.18,4.62,1.77,9.06,4.07,13.76,5.54,4.44,1.39,8.64-.38,12.49-2.61A9.14,9.14,0,0,0,378.33,284.31Z"
              />
              <path
                class="cls-2"
                d="M54.09,204.49c-10.83-2.05-23,3.9-28.11,13.6a46.59,46.59,0,0,0-5,22.53c-.1,1.76-.23,3.25-.24,4.75-.11,19.38,2.8,38.06,13.55,54.69a14.21,14.21,0,0,0,7,5.71c2.77.85,6.82.74,9.11-.76,3.16-2.09,2.66-6.13,1.14-9.59-.15-.35-.31-.69-.42-1-3.52-10.86-8.64-21.24-8-33.22.29-5.56,2.34-9.25,7.11-11.67,3.78-1.92,7.56-3.86,11.4-5.64,6.32-2.92,9.55-7.53,10.25-14.71C72.93,218.47,64.72,206.5,54.09,204.49Zm-11,29.06c-3.7-.2-4.33-1.9-3.86-10.36.19-3.52,1.42-4.29,6.41-4,4.73.27,7.91,2.94,7.7,6.45C53.1,230,48.19,233.83,43.11,233.55Z"
              />
              <path
                class="cls-2"
                d="M303.33,308.56c2.24-15.9.13-30.63-2.57-45.32a74.34,74.34,0,0,1-1.29-10.3c-.12-3-1.16-4.18-4-3.41a30.88,30.88,0,0,1-7.62,1.54c-1.28,0-3.53-1.51-3.69-2.58-.76-5-1.57-10.16-1.15-15.15.45-5.45,4.93-7.65,9.87-8.8q20.22-4.69,40.41-9.52c2.36-.57,3.73,0,4,2.43.41,4,1,8,.85,11.91-.27,5.07-4.21,7.5-8.45,9C317.83,242.45,316.12,251.79,318,261c1.48,7.32,3.46,14.56,4.74,21.92,1.72,9.92,4,19.62,1.13,29.37-1.37,4.59-.89,10.22-10.67,15.55-4.86,2.82-10-.08-10.22-5.78-.12-2.75.38-10.49.32-12.49A7,7,0,0,1,303.33,308.56Z"
              />
            </g>
            <g id="STEM">
              <path
                class="cls-3"
                d="M193,124.74l-3.17,11.87a24,24,0,0,1-2.46,5.93L185,146.6a33,33,0,0,1-7.61,8.91l-4.54,3.71a30.49,30.49,0,0,1-3.92,2.73l-8.49,5c-1,.56-2,1.07-3,1.54L136.24,177a41.44,41.44,0,0,0-5.06,2.46L110.8,191.25c-.56.33-1.11.67-1.65,1L104,195.74l4.41-18.16a59.91,59.91,0,0,1,2.44-7.74l2.77-7.06a66.89,66.89,0,0,1,10.21-17.62l5.54-7.06a54,54,0,0,1,6.19-6.64l1.61-1.55a64.6,64.6,0,0,1,14.64-10.64l6.45-3.42-10.7-4.68a36.77,36.77,0,0,1-10-6.53l-3-4.1a29.37,29.37,0,0,1-3.37-5.92l-5.77-14-4.28-11.71a42,42,0,0,0-7.3-12.62s-2.49-3.39-5.07-6.62a42.87,42.87,0,0,0-8.22-7.87l-5.5-4,7.87-1a78.5,78.5,0,0,1,16.29-.34l.23,0a12.57,12.57,0,0,1,6.51,2.48l8.49,6.36c.4.31.8.63,1.17,1L148,57.74l5.26,5.79a34.67,34.67,0,0,0,11.14,8.16l5.62,2.6a11,11,0,0,1,1.85,1.08l7.81,5.68a17.6,17.6,0,0,1,2.91,2.68,15.24,15.24,0,0,1,1.6,2.3l4.29,7.3,4.8-22c.16-.73.29-1.47.4-2.21L196,53.69q.42-2.73,1-5.43l2.08-14.48.72-11.89a4.83,4.83,0,0,1,2.83-3.82L215.4,16l-2.07,15.7-.88,6.51a62.36,62.36,0,0,0-.56,8.95l.06,6.3a13.57,13.57,0,0,0,.24,2.54L212,64.41a26.9,26.9,0,0,0,1,7.93l2,7.4,2.22-5.37a37.16,37.16,0,0,0,1-3.91l1.7-9.92a35.77,35.77,0,0,1,4.9-12.85l4.88-9.47,2.89-5.62a10.34,10.34,0,0,0,.73-1.79l3.48-11.59a55.25,55.25,0,0,0,2-10.19l.94-9,.83.77A10.76,10.76,0,0,1,244,7.64v.1l2,8a88.2,88.2,0,0,0,3,8.89L251.55,32l3.25,8.64A27,27,0,0,1,256.34,47l.86,7.3a25.36,25.36,0,0,1-1.64,12.4l-3.27,8.18a9.47,9.47,0,0,1-.82,1.58L241,92.74l10.74-3.16a45.35,45.35,0,0,1,12.78-1.84h4.14a20.6,20.6,0,0,1,6.51,1.06l6.12,2a18.66,18.66,0,0,1,5,2.58l8.17,6c.35.25.7.48,1.06.71l9.54,6.08c.61.39,1.24.75,1.87,1.1l10,5.48-17.66,6.73c-2.23.85-4.49,1.58-6.79,2.21l-11.25,3.07A40.77,40.77,0,0,1,266.43,126l-8.58-.86a32.75,32.75,0,0,1-7.58-1.69L237.57,119c-.41-.15-.81-.3-1.21-.47L223,112.74l6.66,8a40.49,40.49,0,0,0,7.58,7l8.94,6.38a18.94,18.94,0,0,1,1.57,1.27l5.43,4.88a29.49,29.49,0,0,1,6.25,8l1.76,3.26a36.69,36.69,0,0,1,3.84,11l.88,5a68,68,0,0,0,3.29,12.07l3.8,10.12-15.49-8.52a44.53,44.53,0,0,0-9.47-3.86l-11.27-3.13a25.52,25.52,0,0,1-3.47-1.22l-13.57-4.91a38.6,38.6,0,0,1-3.75-1.58l-.74-.36a35.14,35.14,0,0,1-16.55-16.71l-.91-1.93a29.24,29.24,0,0,1-2.43-7.91Z"
              />
            </g>

            <text>
              <textPath
                href="#tomato-path"
                side="right"
                class=" font-mono font-bold text-3xl object-contain text-green-600 {}"
                fill="#114406"
                alignment-baseline="top"
                startOffset="520px"
                v-show="!closed"
              ></textPath>
              <textPath
                href="#tomato-path"
                side="right"
                class=" font-mono font-black text-3xl object-contain text-green-600 "
                fill="#3a842a"
                style="transform:translate3d(0,0,0);"
                alignment-baseline="top"
                startOffset="690px"
              >
                {{ getNextDayOfTheWeek("Saturday", false, new Date(), closed) }}
              </textPath>
            </text>
          </svg>
        </div>
      </div>

      <div>
        <div
          class="p-5 flex justify-center items-center md:items-end md:justify-end"
        >
          <a
            href="https://www.instagram.com/plantas_plants/"
            target="_blank"
            class="flex items-center"
            >More photos on

            <g-image
              src="../../static/images/instagram.png"
              class="ml-2 block"
              style="width: 35px;"
            />
          </a>
        </div>
        <div class="full">
          <a href="https://www.instagram.com/plantas_plants/" target="_blank">
            <div class="grid grid-cols-1 gap-4 md:grid md:grid-cols-3 md:gap-4">
              <div
                v-for="({ url }, index) in instagramImage"
                :key="index"
                class=""
              >
                <g-image :src="url" class="object-contain" />
              </div>
            </div>
          </a>
        </div>

        <!-- <div class="container mx-auto px-4 mt-10">
          <h3
            class="font-mono font-black text-4xl object-contain text-green-600"
          >
            {{ this.$page.post.title }}
          </h3>
          <div
            :class="{ 'pb-10': $page.post.author || $page.post.tags }"
            class="markdown text-lg leading-normal text-gray-700"
            v-html="$page.post.content"
          />
        </div> -->
      </div>
    </main>
  </Layout>
</template>

<script>
import moment from "moment";
import config from "~/.temp/config.js";
import Nav from "@/components/Nav";
import PostItem from "@/components/PostItem";
import Pagination from "@/components/Pagination";
import PostHeader from "~/components/PostHeader";

export default {
  components: {
    PostItem,
    Pagination,
    Nav,
    PostHeader
  },
  data: function() {
    return {
      count: 0,
      instagramImage: "",
      closed: false
    };
  },
  metaInfo() {
    return {
      title: `${this.$page.post.title} ${
        this.$page.post.tag ? "- " + this.$page.post.tag.name : ""
      }`,
      meta: [
        {
          key: "description",
          name: "description",
          content: this.description(this.$page.post)
        },

        { property: "og:type", content: "article" },
        { property: "og:title", content: this.$page.post.title },
        {
          property: "og:description",
          content: this.description(this.$page.post)
        },
        { property: "og:url", content: this.postUrl },
        {
          property: "article:published_time",
          content: moment(this.$page.post.date).format("YYYY-MM-DD")
        },
        { property: "og:image", content: this.ogImageUrl },

        { name: "twitter:card", content: "summary_large_image" },
        { name: "twitter:title", content: this.$page.post.title },
        {
          name: "twitter:description",
          content: this.description(this.$page.post)
        },
        { name: "twitter:site", content: "@cossssmin" },
        { name: "twitter:creator", content: "@cossssmin" },
        { name: "twitter:image", content: this.ogImageUrl }
      ]
    };
  },
  methods: {
    instaImage() {
      this.instagramImage = this.$page.allInstagramPhoto.edges
        .reverse()
        .map((value, index) => {
          return { url: value.node.display_url };
        });
    },
    getNextDayOfTheWeek(dayName, excludeToday, refDate, cancel) {
      const dayOfWeek = [
        "sun",
        "mon",
        "tue",
        "wed",
        "thu",
        "fri",
        "sat"
      ].indexOf(dayName.slice(0, 3).toLowerCase());
      if (dayOfWeek < 0) return;
      refDate.setHours(0, 0, 0, 0);
      refDate.setDate(
        refDate.getDate() +
          !!excludeToday +
          ((dayOfWeek + 7 - refDate.getDay() - !!excludeToday) % 7)
      );
      const dtf = new Intl.DateTimeFormat("en", {
        year: "numeric",
        month: "short",
        day: "2-digit"
      });
      const [
        { value: mo },
        ,
        { value: da },
        ,
        { value: ye }
      ] = dtf.formatToParts(refDate);
      const next = cancel
        ? `PLANTaS is closed ! Sorry !`
        : `Next PLANTaS is ${mo} ${da} ${ye}`;
      return next;
    },
    imageLoadError(e) {
      e.target.src = `/images/authors/default.png`;
    },
    description(post, length, clamp) {
      if (post.description) {
        return post.description;
      }

      length = length || 280;
      clamp = clamp || " ...";
      let text = post.content
        .replace(/<pre(.|\n)*?<\/pre>/gm, "")
        .replace(/<[^>]+>/gm, "");

      return text.length > length ? `${text.slice(0, length)}${clamp}` : text;
    },
    titleCase(str) {
      return str
        .replace("-", " ")
        .split(" ")
        .map(s => s.charAt(0).toUpperCase() + s.substring(1))
        .join(" ");
    }
  },
  computed: {
    config() {
      return config;
    },
    ogImageUrl() {
      return (
        this.$page.post.cover || `${this.config.siteUrl}/images/bleda-card.png`
      );
    }
  },
  mounted() {
    this.instaImage();
  }
};
</script>

<style scoped>
.circle {
  max-width: 400px;
  max-height: 400px;
}
html,
body,
svg {
  height: 100%;
}

.cls-1 {
  fill: #870202;
}
.cls-2 {
  fill: #fff;
}
.cls-3 {
  fill: #114406;
}
</style>

<page-query>
query {
  post (path: "/about") {
      title
      path
      slug
      datetime: date (format: "YYYY-MM-DD HH:mm:ss")
      content
      description
      timeToRead
      cover
      fullscreen
      schedule
      author {
        id
        title
        path
      }
      tags {
        id
        title
        path
    }
  }
  allInstagramPhoto {
    edges {
      node {
        display_url
        edge_media_to_caption {
          edges {
            node {
              text
            }
          }
        }
      }
    }
  }
}
</page-query>

/* <page-query>
  query Home ($page: Int) {
    posts: allPost (page: $page, perPage: 6) @paginate {
      totalCount
      pageInfo {
        totalPages
        currentPage
      }
      edges {
        node {
          id
          title
          timeToRead
          datetime: date (format: "YYYY-MM-DD HH:mm:ss")
          content
          excerpt
          description
          path
          cover
          tags {
            id
            title
            path
          }
          author {
            id
            title
            path
          }
        }
      }
    }
  }
</page-query> */

<static-query>
query {
  metadata {
    siteName
    siteUrl
    siteDescription
  }
}
</static-query>
